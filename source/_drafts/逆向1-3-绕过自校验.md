title: 逆向1-3 绕过自校验
author: 7h4mid4
tags:
  - 逆向
categories:
  - 逆向
date: 2019-12-18 21:29:00
---
对于有些程序，如果脱壳后运行时无效，则应该考虑是否存在程序的自校验。

比较常用的自校验技巧是用GetFileSize()函数对文件的前后大小做比较。

因为脱壳后一般文件大小会比脱壳前的大很多。

所以通过GetFileSize API 的对文件大小的取值进行判断，可以判断文件是否被脱壳。

如果被脱壳，则直接退出程序。

即出现无法打开程序的情况。

所以在这种情况下，我们需要对GetFileSize函数下断点




然后F9执行后跟踪堆栈中的数据



![upload successful](/images/pasted-102.png)



跟踪后寻找判断大小的语句然后进一步修改，nop也行，改寄存器也行，改汇编也行接着保存修改再运行时就不会出现闪退或者无反应的情况了。


上一种自校验校验的目的是为了防止程序被脱壳

但是程序在未脱壳的前提下也存在被破解的可能

所以这种自校验的目的是校验是否存在使用OD等直接修改程序数据的行为存在

该校验方式被称为重启自校验。

即在运行中先将正确的注册码等数据存储在文件或是注册表项等地方

等到重启时，将上次输入的注册码与正确的注册码进行比对，只有比对成功才能永久解锁。

所以，破解该类型程序的重点在于在程序刚重启时，在判断注册码之前修改部分代码，以达到完全破解的目标。

所以我们要对GetStartupInfoA()函数下断点

该函数是初始化函数，会断在程序运行之前，该校验方式就会停到从注册表项中取内容的那一步上

然后F8向下隔不久之后就能够看见关键call，和test 或者是cmp之类的判断内容

至此，修改标志位或读取真注册表项即可得到软件使用权限。
